input {
  # TODO(trebskit) should initial list contain some files to be
  # monitored ?
  file {
    add_field => { "dimensions" => { "service" => "system" }}
    path => "/var/log/messages"
    tags => ["syslog"]
  }
}

filter {
  if "syslog" in [tags] {
    multiline {
      negate => "true"
      pattern => "^%{SYSLOGTIMESTAMP}"
      what => "previous"
    }
  }
}

output {
  monasca_log_api {
    ### keystone based settings
    keystone_api_url => "<%= @keystone_settings['internal_auth_url'] %>"
    project_name => "<%= @keystone_settings['service_tenant'] %>"
    username => "<%= @keystone_settings['service_user'] %>"
    password => "<%= @keystone_settings['service_password'] %>"
    user_domain_name => "<%= @keystone_settings['admin_domain'] %>"
    project_domain_name => "<%= @keystone_settings['admin_domain'] %>"
    ### monasca specific settings
    monasca_log_api_url => "<%= @log_agent_settings['monasca_log_api_url'] %>"
<%- unless @log_agent_dimensions.nil? then -%>
    dimensions => [<%= @log_agent_dimensions.map{|k,v| "\"#{k}\":\"#{v}\""}.join(',') %>]
<%- else -%>
    dimensions => []
<%- end -%>
  }
}
